<template>
  <div style="height: 100%;">
    <el-row :gutter="10" style="height: 100%;">
      <el-col :span="6" :xs="24">
        <card v-loading="$asyncComputed.document.updating" :patient="person" />
        <el-button type="primary" @click="$router.go(-1)">返回 </el-button>
      </el-col>
      <el-col :span="18" :xs="24" style="height: 100%;">
        <el-card
          v-loading="$asyncComputed.personDetailSeverData.updating"
          shadow="never"
          style="height: 100%;"
          :body-style="{
            height: 'calc(100% - 40px)',
            padding: $settings.isMobile ? '10px 0 0' : '20px'
          }"
        >
          <el-tabs
            v-model="activeTab"
            class="patient-tab-list"
            @tab-click="tabClick"
          >
            <el-tab-pane
              v-if="personDetailSeverData.length"
              label="个人基本信息表"
              name="personal"
            >
              <div v-hidden-scroll>
                <div style="padding: 5px;">
                  <div style="float: right;">
                    编号：{{ personDetailData.id }}
                  </div>
                  姓名：<strong>{{ personDetailData.name }}</strong>
                </div>

                <table class="base-info-table">
                  <tbody>
                    <tr>
                      <td colspan="4">性别</td>
                      <td colspan="12">
                        1男 2女 9未说明的性别 0未知的性别
                        <em>{{ personDetailData.gender }}</em>
                      </td>
                      <td colspan="4">出生日期</td>
                      <td colspan="4">
                        <em>{{ personDetailData.birth }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">身份证号</td>
                      <td colspan="8">
                        <em>{{ personDetailData.idCard }}</em>
                      </td>
                      <td colspan="4">工作单位</td>
                      <td colspan="8">
                        <em>{{ personDetailData.workUnit }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">本人电话</td>
                      <td colspan="4">
                        <em>{{ personDetailData.phone }}</em>
                      </td>
                      <td colspan="4">联系人姓名</td>
                      <td colspan="4">
                        <em>{{ personDetailData.contactName }}</em>
                      </td>
                      <td colspan="4">联系人电话</td>
                      <td colspan="4">
                        <em>{{ personDetailData.contactPhone }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">常住类型</td>
                      <td colspan="8">
                        <el-radio-group
                          v-model="personDetailData.livingConditions"
                        >
                          <el-radio label="1">1户籍</el-radio>
                          <el-radio label="2">2非户籍</el-radio>
                        </el-radio-group>
                      </td>
                      <td colspan="4">民族</td>
                      <td colspan="8">
                        1汉族 2少数民族
                        <em>{{ personDetailData.national }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">血型</td>
                      <td colspan="20">
                        <el-radio-group v-model="personDetailData.blood">
                          <el-radio label="1">A型</el-radio>
                          <el-radio label="2">B型</el-radio>
                          <el-radio label="3">O型</el-radio>
                          <el-radio label="4">AB型</el-radio>
                          <el-radio label="5">不详</el-radio>
                        </el-radio-group>
                        /
                        <el-radio-group v-model="personDetailData.RH">
                          <el-radio label="1">阴性</el-radio>
                          <el-radio label="2">阳性</el-radio>
                          <el-radio label="3">不详</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">文化程度</td>
                      <td colspan="20">
                        <el-radio-group v-model="personDetailData.education">
                          <el-radio label="1">研究生</el-radio>
                          <el-radio label="2">大学本科</el-radio>
                          <el-radio label="3">大学专科和专科学校</el-radio>
                          <el-radio label="4">中等专业学校</el-radio>
                          <el-radio label="5">技工学校</el-radio>
                          <el-radio label="6">高中</el-radio>
                          <el-radio label="7">初中</el-radio>
                          <el-radio label="8">小学</el-radio>
                          <el-radio label="9">文盲或半文盲</el-radio>
                          <el-radio label="10">不详</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">职业</td>
                      <td colspan="20">
                        <el-radio-group v-model="personDetailData.profession">
                          <el-radio label="0"
                            >国家机关、党群组织、企业、事业单位负责人</el-radio
                          >
                          <el-radio label="1">专业技术人员</el-radio>
                          <el-radio label="2">办事人员和有关人员</el-radio>
                          <el-radio label="3">商业、服务业人员</el-radio>
                          <el-radio label="4"
                            >农、林、牧、渔、水利业生产人员</el-radio
                          >
                          <el-radio label="5">
                            生产、运输设备操作人 员及有关人员</el-radio
                          >
                          <el-radio label="6">军人</el-radio>
                          <el-radio label="7">不便分类的其他从业人员</el-radio>
                          <el-radio label="8">无职业</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">婚姻状况</td>
                      <td colspan="20">
                        <el-radio-group v-model="personDetailData.marrage">
                          <el-radio label="1">未婚</el-radio>
                          <el-radio label="2">已婚</el-radio>
                          <el-radio label="3">丧偶</el-radio>
                          <el-radio label="4">离婚</el-radio>
                          <el-radio label="5">未说明婚姻状况</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">医疗费用支付方式</td>
                      <td colspan="20">
                        1城镇职工基本医疗保险 2城镇居民基本医疗保险
                        3新型农村合作医疗 4贫困救助 5商业医疗保险 6全公费
                        7全自费 8其他
                        <em>{{ personDetailData.medicalPayType }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">药物过敏史</td>
                      <td colspan="20">
                        1无 2青霉素 3磺胺 4链霉素 5其他
                        <em>{{ personDetailData.drugAllergy }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">暴露史</td>
                      <td colspan="20">
                        1无 2化学品 3毒物 4射线
                        <em>{{ personDetailData.exposureHistory }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td rowspan="4" colspan="2">既往史</td>
                      <td colspan="2">疾病</td>
                      <td colspan="20">
                        1无 2高血压 3糖尿病 4冠心病 5慢性阻塞性肺疾病 6恶性肿瘤
                        7脑卒中 8严重精神障碍 9结核病 10肝炎 11其他法定传染病
                        12职业病 13其他
                        <em>{{ personDetailData.diseaseHistory }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="2">手术</td>
                      <td colspan="20">
                        <el-radio-group
                          v-model="personDetailData.isSurgeryHistory"
                        >
                          <el-radio :label="false">1无</el-radio>
                          <el-radio :label="true">2有</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="2">外伤</td>
                      <td colspan="20">
                        <el-radio-group
                          v-model="personDetailData.isTraumaticHistory"
                        >
                          <el-radio :label="false">1无</el-radio>
                          <el-radio :label="true">2有</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="2">输血</td>
                      <td colspan="20">
                        <el-radio-group
                          v-model="personDetailData.isTransfusionHistory"
                        >
                          <el-radio :label="false">1无</el-radio>
                          <el-radio :label="true">2有</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td rowspan="3" colspan="4">家族史</td>
                      <td colspan="4">父亲</td>
                      <td colspan="6">
                        <em>{{ personDetailData.fatherHistory }}</em>
                      </td>
                      <td colspan="4">母亲</td>
                      <td colspan="6">
                        <em>{{ personDetailData.motherHistory }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">兄弟姐妹</td>
                      <td colspan="6">
                        <em>{{ personDetailData.siblingHistory }}</em>
                      </td>
                      <td colspan="4">子女</td>
                      <td colspan="6">
                        <em>{{ personDetailData.childrenHistory }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="20">
                        1无 2高血压 3糖尿病 4冠心病 5慢性阻塞性肺疾病 6恶性肿瘤
                        7脑卒中 8严重精神障碍 9结核病 10肝炎 11先天畸形 12其他
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">遗传病史</td>
                      <td colspan="20">
                        <el-radio-group
                          v-model="personDetailData.isGeneticHistory"
                        >
                          <el-radio :label="false">1无</el-radio>
                          <el-radio :label="true">2有</el-radio>
                        </el-radio-group>
                        疾病名称：<em>{{ personDetailData.geneticDisease }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">残疾情况</td>
                      <td colspan="20">
                        1无残疾 2视力残疾 3听力残疾 4言语残疾 5肢体残疾
                        6智力残疾 7精神残疾 8其他残疾
                        <em>{{ personDetailData.isDisability }}</em>
                      </td>
                    </tr>
                    <tr>
                      <td rowspan="5" colspan="4">生活环境*</td>
                      <td colspan="4">厨房排风措施</td>
                      <td colspan="16">
                        <el-radio-group
                          v-model="personDetailData.kitchenVentilation"
                        >
                          <el-radio label="1">1无</el-radio>
                          <el-radio label="2">2油烟机</el-radio>
                          <el-radio label="3">3换气扇</el-radio>
                          <el-radio label="4">4烟囱</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">燃料类型</td>
                      <td colspan="16">
                        <el-radio-group v-model="personDetailData.FuelType">
                          <el-radio label="1">1液化气</el-radio>
                          <el-radio label="2">2煤</el-radio>
                          <el-radio label="3">3天然气</el-radio>
                          <el-radio label="4">4沼气</el-radio>
                          <el-radio label="5">5柴火</el-radio>
                          <el-radio label="6">6其他</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">饮水</td>
                      <td colspan="16">
                        <el-radio-group v-model="personDetailData.water">
                          <el-radio label="1">1自来水</el-radio>
                          <el-radio label="2">2经净化过滤的水</el-radio>
                          <el-radio label="3">3井水</el-radio>
                          <el-radio label="4">4河湖水</el-radio>
                          <el-radio label="5">5塘水</el-radio>
                          <el-radio label="6">6其他</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">厕所</td>
                      <td colspan="16">
                        <el-radio-group v-model="personDetailData.toilet">
                          <el-radio label="1">1卫生厕所</el-radio>
                          <el-radio label="2">2一格或二格粪池式</el-radio>
                          <el-radio label="3">3马桶</el-radio>
                          <el-radio label="4">4露天粪坑</el-radio>
                          <el-radio label="5">5简易棚厕</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4">禽畜栏</td>
                      <td colspan="16">
                        <el-radio-group v-model="personDetailData.livestock">
                          <el-radio label="1">1无</el-radio>
                          <el-radio label="2">2单设</el-radio>
                          <el-radio label="3">3室内</el-radio>
                          <el-radio label="4">4室外</el-radio>
                        </el-radio-group>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </el-tab-pane>
            <el-tab-pane
              v-for="(item, i) in titleList"
              :key="i"
              :name="item.code"
              :disabled="item.disabled"
            >
              <span slot="label">
                <i
                  :class="item.updating ? 'el-icon-loading' : 'el-icon-s-order'"
                />
                {{ item.label }}
              </span>

              <div v-show="item.code === 'physical'" v-hidden-scroll>
                <div class="record">
                  <div class="title">体验记录</div>
                  <div class="list">
                    <div
                      v-for="(items, index) of healthyList"
                      :key="index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'record-healthy',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div class="notes-date">
                        {{ items.checkDate }}
                      </div>
                      <div class="notes-content">
                        <div>
                          身高：{{ items.stature }}<br />
                          体重：{{ items.weight }}<br />
                          体温：<span :class="{warn: items.temperature > 37.2}"
                            >{{ items.temperature }}
                          </span>
                        </div>
                        <div
                          :class="{
                            warn: !String(items.symptom).includes('无症状')
                          }"
                        >
                          {{ items.symptom }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div v-show="item.code === 'hypertension'" v-hidden-scroll>
                <div class="record hypertension">
                  <div class="title">高血压随访记录</div>
                  <sliders v-if="hypertensions.length" :key="keyCode + 'a'">
                    <div
                      v-for="(items, index) of hypertensions"
                      :key="index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'record-hypertension',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div>随访时间：{{ items.followDate }}</div>
                      <div class="main">
                        收缩压：{{ items.systolicPressure }}；舒张压：{{
                          items.assertPressure
                        }}
                      </div>
                      <div>
                        随访方式：{{ items.followWay }}；随访医生：{{
                          items.doctor
                        }}
                      </div>
                    </div>
                  </sliders>
                </div>
              </div>

              <div v-show="item.code === 'diabetes'" v-hidden-scroll>
                <div class="record hypertension">
                  <div class="title">糖尿病随访记录</div>
                  <sliders v-if="diabetesList.length" :key="keyCode + 'b'">
                    <div
                      v-for="(items, index) of diabetesList"
                      :key="index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'record-diabetes',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div>随访时间：{{ items.followDate }}</div>
                      <div class="main">
                        空腹血糖：{{ items.fastingGlucose }}；随机血糖：{{
                          items.postprandialGlucose
                        }}
                      </div>
                      <div>
                        随访方式：{{ items.followWay }}；随访医生：{{
                          items.doctor
                        }}
                      </div>
                    </div>
                  </sliders>
                </div>
              </div>

              <div v-show="item.code === 'oldManSelfCare'" v-hidden-scroll>
                <div v-if="oldManSelfCareList.length" class="record">
                  <div class="title">
                    老年人生活自理评分
                  </div>
                  <div class="list">
                    <div
                      v-for="(items, index) of oldManSelfCareList"
                      :key="'old' + index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'record-oldManSelfCare',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div class="notes-date">
                        评估时间：{{ items.checkDate }}
                      </div>
                      <div class="notes-content" style="position: relative;">
                        <div>
                          进餐：{{ items.mealScore }}<br />
                          梳洗：{{ items.washScore }}<br />
                          穿衣：{{ items.dressScore }}<br />
                          如厕：{{ items.toiletScore }}<br />
                          活动：{{ items.activityScore }}
                        </div>
                        <div>
                          {{ items.total }}
                          <span
                            style="position: absolute; bottom: 5px;right: 5px;"
                          >
                            总分
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  v-if="questionnaireList.length"
                  class="record questionnaire"
                >
                  <div class="title">老年人中医药健康管理服务记录表</div>
                  <div class="list">
                    <div
                      v-for="(items, index) of questionnaireList"
                      :key="index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'record-old-constitution',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div class="notes-date">问卷时间：{{ items.date }}</div>
                      <div>机构名称：{{ items.hospitalName }}</div>
                      <div>医生姓名：{{ items.doctor }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <div v-show="item.code === 'maternal'" v-hidden-scroll>
                <div v-for="(items, index) of maternalData" :key="index">
                  <div style="font-size: 22px; margin:20px 0">
                    第{{ index + 1 }}次生产记录
                  </div>
                  <div class="maternal">
                    <div
                      v-for="(it, itIndex) in items.slice(0, 2)"
                      :key="itIndex"
                      :class="'record-' + itIndex"
                    >
                      <div class="record-title">{{ it.name }}</div>
                      <div
                        v-for="(record, recordIndex) of it.records"
                        :key="recordIndex"
                        class="notes"
                        @click="handleGotoDetailse(record, it.type)"
                      >
                        <div>
                          <span v-if="it.type === 'newlyDiagnosed'">
                            填表日期：{{
                              record.newlydiagnoseddate.$format('YYYY-MM-DD')
                            }}
                          </span>
                          <span v-else-if="it.type === 'prenatalCare'">
                            随访日期：{{
                              record.checkdate.$format('YYYY-MM-DD')
                            }}
                          </span>
                          <span
                            v-else-if="
                              it.type === 'maternalVisits' ||
                                it.type === 'examine42thDay'
                            "
                          >
                            访视日期：{{
                              record.visitdate.$format('YYYY-MM-DD')
                            }}
                          </span>
                        </div>
                        <div>
                          <span
                            v-if="it.type === 'newlyDiagnosed'"
                            class="main"
                          >
                            年龄：{{ record.age }} 体重：{{ record.weight }}kg
                          </span>
                          <span
                            v-if="
                              it.type === 'prenatalCare' ||
                                it.type === 'examine42thDay' ||
                                it.type === 'maternalVisits'
                            "
                          >
                            医生姓名：{{ record.doctor }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="maternal">
                    <div
                      v-for="(it, itIndex) in items.slice(2)"
                      :key="itIndex"
                      :class="'record-' + (itIndex + 2)"
                    >
                      <div class="record-title">{{ it.name }}</div>
                      <div
                        v-for="(record, recordIndex) of it.records"
                        :key="recordIndex"
                        class="notes"
                        @click="handleGotoDetailse(record, it.type)"
                      >
                        <div>
                          <span v-if="it.type === 'newlyDiagnosed'">
                            填表日期：{{
                              record.newlydiagnoseddate.$format('YYYY-MM-DD')
                            }}
                          </span>
                          <span v-else-if="it.type === 'prenatalCare'">
                            随访日期：{{
                              record.checkdate.$format('YYYY-MM-DD')
                            }}
                          </span>
                          <span
                            v-else-if="
                              it.type === 'maternalVisits' ||
                                it.type === 'examine42thDay'
                            "
                          >
                            访视日期：{{
                              record.visitdate.$format('YYYY-MM-DD')
                            }}
                          </span>
                        </div>
                        <div>
                          <span v-if="it.type === 'newlyDiagnosed'">
                            年龄：{{ record.age }} 体重：{{ record.weight }}kg
                          </span>
                          <span
                            v-if="
                              it.type === 'prenatalCare' ||
                                it.type === 'examine42thDay' ||
                                it.type === 'maternalVisits'
                            "
                          >
                            医生姓名：{{ record.doctor }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div v-show="item.code === 'children'" v-hidden-scroll>
                <div
                  v-if="childrenHealthLength.length > 1"
                  style="text-align: right"
                >
                  新生儿姓名：<el-select
                    v-model="curChild"
                    placeholder="请选择"
                    size="small"
                    style="margin-bottom: 10px;"
                    @change="tabClick"
                  >
                    <el-option
                      v-for="(items, ii) in childrenHealthLength"
                      :key="ii"
                      :label="items.children"
                      :value="items.birthday"
                    >
                    </el-option>
                  </el-select>
                </div>

                <div
                  v-for="(items, index) of childrenHealthCheckData"
                  :key="index"
                >
                  <div v-if="items.type === 'newbornVisit'" class="children">
                    <div style="font-size: 22px; margin:0 0 20px 0">
                      {{ items.name }}
                    </div>
                    <sliders v-if="items.records.length" :key="keyCode + 'c'">
                      <div
                        v-for="record of items.records"
                        :key="record.visitno"
                        class="notes"
                        :style="{
                          display:
                            !curChild ||
                            curChild.toString() ===
                              record.newbornbirthday.toString()
                              ? 'block'
                              : 'none'
                        }"
                        @click="handleGotoDetailse(record, item.type)"
                      >
                        <div>
                          <div>
                            访视日期：{{
                              record.visitdate.$format('YYYY-MM-DD')
                            }}
                          </div>
                          <div class="main">
                            新生儿姓名：{{ record.newbornname }} <br />体温：{{
                              record.temperaturedegrees
                                ? record.temperaturedegrees.toFixed(1)
                                : ''
                            }}
                          </div>
                          <div class="doctor">
                            访视医生：{{ record.doctor }}
                          </div>
                        </div>
                      </div>
                    </sliders>
                  </div>
                  <div v-else-if="items.type === 'childCheck'">
                    <div
                      v-for="(it, ii) of items.records"
                      :key="ii"
                      class="children"
                      :style="{
                        display:
                          !curChild || curChild === it[0].birthday
                            ? 'block'
                            : 'none'
                      }"
                    >
                      <div>
                        <div style="font-size: 22px; margin:0 0 20px 0">
                          {{ items.name }}
                        </div>
                        <div style="text-align: right;">
                          儿童姓名：{{ it[0].childname }}
                        </div>
                      </div>
                      <sliders v-if="it.length" :key="ii + keyCode + 'd'">
                        <div
                          v-for="record of it"
                          :key="record.medicalcode"
                          class="notes"
                          @click="handleGotoDetailse(record, items.type)"
                        >
                          <div>
                            <div>
                              检查日期：{{
                                record.checkdate.$format('YYYY-MM-DD')
                              }}
                            </div>
                            <div class="main">
                              月龄: {{ record.chronologicalage }} 身高：{{
                                record.height
                              }}cm 体重：{{ record.weight }}kg
                            </div>
                            <div class="doctor">
                              检查医生：{{ record.checkdoctor }}
                            </div>
                          </div>
                        </div>
                      </sliders>
                      <GrowthChart
                        ref="chart"
                        :key="ii + keyCode"
                        :data="items.chartData[ii]"
                        :style="{
                          height: '500px',
                          width: 'calc(100% - 80px)',
                          backgroundColor: '#fff',
                          overflow: 'auto',
                          margin: '10px 40px 40px'
                        }"
                      ></GrowthChart>
                    </div>
                  </div>
                </div>
              </div>

              <div v-show="item.code === 'chronicDiseaseOther'" v-hidden-scroll>
                <div class="record hypertension">
                  <div class="title">
                    其它慢病管理记录
                  </div>
                  <sliders
                    v-if="chronicDiseaseOtherData.length"
                    :key="keyCode + 'e'"
                  >
                    <div
                      v-for="(items, index) of chronicDiseaseOtherData"
                      :key="index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'chronic-disease-other-visit',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div>随访时间：{{ items.followDate }}</div>
                      <div class="main">
                        当前症状：{{ items.presentSymptoms }}
                      </div>
                      <div>
                        随访方式：{{ items.followWay }} 随访医生：{{
                          items.doctor
                        }}
                      </div>
                    </div>
                  </sliders>
                </div>
              </div>

              <div v-show="item.code === 'chronicDiseaseHigh'" v-hidden-scroll>
                <div class="record chronicDiseaseHigh">
                  <div class="title">高危人群管理记录</div>
                  <div class="list">
                    <div
                      v-for="(items, index) of chronicDiseaseHighData"
                      :key="index"
                      class="notes"
                      @click="
                        $router.push({
                          name: 'chronic-disease-high-visit',
                          query: {
                            id: items.id
                          }
                        })
                      "
                    >
                      <div class="note-date">
                        随访时间：{{ items.followDate
                        }}<span style="float: right;"
                          >随访医生：{{ items.doctor }}</span
                        >
                      </div>
                      <div class="notes-content">
                        <div>
                          当前症状
                        </div>
                        <div>{{ items.riskFactorsName }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </el-tab-pane>
          </el-tabs>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>

<script>
import card from './components/card';
import sliders from '../../components/sliders';
import GrowthChart from '../../components/growth-chart';
import {getTagsList} from '../../../../common/person-tag.ts';
export default {
  name: 'Patient',
  components: {card, sliders, GrowthChart},
  data() {
    return {
      id: null,
      curChild: '',
      keyCode: new Date().getTime(),
      activeTab: 'personal'
    };
  },
  computed: {
    person() {
      return getTagsList(this.document);
    },
    hypertensions() {
      return this.hypertension.map(it => {
        it.followDate = it.followDate
          ? it.followDate.$format('YYYY-MM-DD')
          : '';
        return it;
      });
    },
    healthyList() {
      return this.healthy.map(it => {
        it.checkDate = it.checkDate ? it.checkDate.$format('YYYY-MM-DD') : '';
        return it;
      });
    },
    diabetesList() {
      return this.diabetes.map(it => {
        it.followDate = it.followDate
          ? it.followDate.$format('YYYY-MM-DD')
          : '';
        return it;
      });
    },
    personDetailData() {
      return this.personDetailSeverData.map(it => {
        it.birth = it.birth.$format('YYYY-MM-DD');
        return it;
      })[0];
    },
    questionnaireList() {
      return this.questionnaire.map(it => {
        it.date = it.date ? it.date.$format('YYYY-MM-DD') : '';
        return it;
      });
    },
    oldManSelfCareList() {
      return this.oldManSelfCare.map(it => {
        it.checkDate = it.checkDate ? it.checkDate.$format('YYYY-MM-DD') : '';
        return it;
      });
    },
    maternalData() {
      return this.maternalServerData;
    },
    // 儿童健康管理记录数据
    childrenHealthCheckData() {
      return this.childrenHealthCheckServerData.map(it => ({
        ...it,
        chartData: it.chartData
          ? it.chartData.map(c => ({
              weights: c.map(w => [
                Number(w.chronologicalage),
                Number(w.weight)
              ]),
              heights: c.map(w => [
                Number(w.chronologicalage),
                Number(w.height)
              ])
            }))
          : ''
      }));
    },
    // 儿童数量
    childrenHealthLength: function() {
      return (
        this.childrenHealthCheckServerData[1]?.records.map(it => ({
          birthday: it[0].birthday,
          children: it[0].childname
        })) || []
      );
    },
    // 高危人群规范管理列表数据
    chronicDiseaseHighData() {
      return this.chronicDiseaseHighServerData.map(it => ({
        ...it,
        followDate: it.followDate?.$format('YYYY-MM-DD')
      }));
    },
    // 其它慢病规范管理列表数据
    chronicDiseaseOtherData() {
      return this.chronicDiseaseOtherServerData.map(it => ({
        ...it,
        followDate: it.followDate ? it.followDate.$format('YYYY-MM-DD') : ''
      }));
    },
    // 添加默认排序
    titleList() {
      this.tabClick();
      return [
        {
          code: 'physical',
          label: '体检记录',
          disabled: this.healthyList.length < 1,
          updating: this.$asyncComputed.healthy.updating
        },
        {
          code: 'hypertension',
          label: '高血压随访记录',
          disabled: this.hypertensions.length < 1,
          updating: this.$asyncComputed.hypertension.updating
        },
        {
          code: 'diabetes',
          label: '糖尿病随访记录',
          disabled: this.diabetesList.length < 1,
          updating: this.$asyncComputed.diabetes.updating
        },
        {
          code: 'oldManSelfCare',
          label: '老年人特殊健康管理服务记录',
          disabled:
            this.oldManSelfCareList.length < 1 &&
            this.questionnaireList.length < 1,
          updating: this.$asyncComputed.oldManSelfCare.updating
        },
        {
          code: 'chronicDiseaseHigh',
          label: '高危人群管理记录',
          disabled: this.chronicDiseaseHighData.length < 1,
          updating: this.$asyncComputed.chronicDiseaseHighServerData.updating
        },
        {
          code: 'chronicDiseaseOther',
          label: '其它慢病管理记录',
          disabled: this.chronicDiseaseOtherData.length < 1,
          updating: this.$asyncComputed.chronicDiseaseOtherServerData.updating
        },
        {
          code: 'maternal',
          label: '孕产妇健康管理记录',
          disabled: this.maternalData.length < 1,
          updating: this.$asyncComputed.maternalServerData.updating
        },
        {
          code: 'children',
          label: '儿童健康检查管理记录',
          disabled: this.childrenHealthCheckData.length < 1,
          updating: this.$asyncComputed.childrenHealthCheckServerData.updating
        }
      ].sort((a, b) => a.disabled - b.disabled);
    }
  },
  created() {
    const id = this.$route.query.id;
    if (!id) this.$router.push('/person');
    this.id = id;
  },
  asyncComputed: {
    document: {
      async get() {
        return await this.$api.Person.document(this.id);
      },
      default() {
        return {
          id: '',
          name: '',
          address: '',
          census: '', //户籍地址
          phone: '', //联系电话
          operateOrganization: {
            //建档机构
            id: '',
            name: ''
          },
          organization: {
            id: '',
            name: ''
          },
          fileDate: '' //建档日期
        };
      }
    },
    healthy: {
      //体检记录
      async get() {
        return await this.$api.Person.healthy(this.id);
      },
      default() {
        return [];
      }
    },
    hypertension: {
      //高血压随访
      async get() {
        return await this.$api.Person.hypertensions(this.id);
      },
      default() {
        return [];
      }
    },
    diabetes: {
      //糖尿病随访
      async get() {
        return await this.$api.Person.diabetes(this.id);
      },
      default() {
        return [];
      }
    },
    personDetailSeverData: {
      async get() {
        return await this.$api.Person.personDetail(this.id);
      },
      default() {
        return [];
      }
    },
    questionnaire: {
      async get() {
        return await this.$api.Person.questionnaire(this.id);
      },
      default() {
        return [];
      }
    },
    oldManSelfCare: {
      async get() {
        return await this.$api.Person.oldManSelfCare(this.id);
      },
      default() {
        return [];
      }
    },
    maternalServerData: {
      async get() {
        return await this.$api.Person.maternalHealthCheck(this.id);
      },
      default() {
        return [];
      }
    },
    childrenHealthCheckServerData: {
      async get() {
        const result = await this.$api.Person.childrenHealthCheck(this.id);
        if (result[1]?.records?.length > 1) {
          this.curChild = result[1].records[0][0].birthday;
        }
        return await Promise.all(
          result.map(async item => {
            return {
              ...item,
              chartData:
                item.type === 'childCheck'
                  ? await Promise.all(
                      item.records.map(
                        async it =>
                          await this.$api.Person.developmentMonitoring(
                            it[0].childhealthbooksno
                          )
                      )
                    )
                  : ''
            };
          })
        );
      },
      default() {
        return [];
      }
    },
    // 高危人群规范管理列表数据
    chronicDiseaseHighServerData: {
      async get() {
        return await this.$api.Person.chronicDiseaseHighList(this.id);
      },
      default() {
        return [];
      }
    },
    // 其他慢病规范管理列表数据
    chronicDiseaseOtherServerData: {
      async get() {
        return await this.$api.Person.chronicDiseaseOtherList(this.id);
      },
      default() {
        return [];
      }
    }
  },
  methods: {
    tabClick() {
      this.keyCode = new Date().getTime();
    },
    handleBack() {
      this.$router.go(-1);
    },

    // 跳转到相应的体检表详情
    handleGotoDetailse(record, type) {
      let routerName = '';
      let code = '';
      if (type === 'newlyDiagnosed') {
        //第一次产前检查信息表
        routerName = 'record-first-prenatal-check';
        code = record.newlydiagnosedcode;
      } else if (type === 'prenatalCare') {
        //第2~5次产前随访服务信息表
        routerName = 'record-prenatal-follow-up';
        code = record.prenatalcarecode;
      } else if (type === 'maternalVisits') {
        //产后访视记录表
        routerName = 'record-postpartum-visit';
        code = record.visitcode;
      } else if (type === 'examine42thDay') {
        //产后42天健康检查记录表
        routerName = 'record-postpartum-42-days-check';
        code = record.examineno;
      } else if (type === 'newbornVisit') {
        // 新生儿家庭访视记录表
        routerName = 'record-newborn-visit';
        code = record.visitno;
      } else if (type === 'childCheck') {
        // 0-6岁儿童体检表
        code = record.medicalcode;
        if (Number(record.chronologicalage) < 12) {
          // 1～8月龄儿童健康检查记录表
          routerName = 'record-infant-health-check';
        } else if (Number(record.chronologicalage) < 36) {
          // 12～30月龄儿童健康检查记录表
          routerName = 'record-toddler-health-check';
        } else {
          // 3～6岁儿童健康检查记录表
          routerName = 'record-child-health-check';
        }
      }
      if (routerName && code) {
        this.$router.push({
          name: routerName,
          query: {
            id: code
          }
        });
      }
    }
  }
};
</script>

<style lang="scss">
@media screen and (max-width: 414px) {
  .patient-tab-list {
    table {
      td {
        display: block;
        margin-left: 4px;
        width: calc(100% - 36px);
        border-left: none !important;
        font-size: 14px;
      }
    }
    .notes {
      padding: 0 10px;
    }
  }
}
.patient-tab-list {
  height: 100%;
  display: flex;
  flex-direction: column;
  .el-tabs__content {
    height: 100%;
    flex: 1;
    .el-tab-pane {
      height: 100%;
      position: relative;

      & > div {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        overflow-x: hidden;
        overflow-y: auto;
      }
    }
  }
}
</style>
<style lang="scss" scoped>
@import '../../styles/vars';

.notes {
  cursor: pointer;
  color: #42486d;
  background-color: #fff;
  border-bottom: 1px solid #eee;
  margin-right: 20px;
  margin-bottom: 10px;
  padding: 10px;
  line-height: 2;
  font-size: 14px;
  border-radius: 6px;
}
.maternal {
  display: flex;
  flex-direction: row;
  background-color: #f0f4ff;
  color: #42486d;
  border-radius: 6px;
  margin-bottom: 20px;
  & > div {
    padding: 10px 0 10px 20px;
    min-width: 180px;
    .notes {
      float: left;
      min-width: 180px;
    }
  }
  .record-title {
    line-height: 2;
  }
  .record-0,
  .record-3 {
    min-width: 220px;
    flex-shrink: 0;
  }
  .record-0 {
    .main {
      font-weight: bold;
    }
  }
  .record-0,
  .record-2 {
    position: relative;
    &:after {
      position: absolute;
      display: block;
      content: '';
      height: 100%;
      top: 0;
      right: 0;
      width: 4px;
      background-color: #fff;
    }
  }
}
.children {
  background-color: #f0f4ff;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 6px;
  .title {
    font-size: 22px;
    margin: 0 0 20px 0;
  }
  .notes {
    min-width: 294px;
    .main {
      font-weight: bold;
    }
    .doctor {
      text-align: right;
    }
  }
}
.record {
  background-color: #f0f4ff;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 6px;
  .title {
    font-size: 22px;
    margin: 0 0 20px 0;
  }
  .list {
    width: 100%;
    padding-left: 40px;
    box-sizing: border-box;
    display: flex;
    flex-wrap: wrap;
    .notes {
      width: 200px;
      .notes-content {
        display: flex;
        flex-direction: row;
        border-top: 2px solid #f0f4ff;
        & > div:first-child {
          width: 50%;
          border-right: 2px solid #f0f4ff;
          padding-top: 5px;
        }
        & > div:last-child {
          width: 50%;
          align-self: center;
          text-align: center;
        }
        .warn {
          color: #f00;
        }
      }
    }
  }
}
.hypertension {
  .notes {
    width: 260px !important;
    .main {
      font-size: 18px;
      line-height: 3;
    }
    & > div:last-child {
      text-align: right;
    }
  }
}
.questionnaire {
  .notes {
    width: 300px !important;
  }
}
.chronicDiseaseHigh {
  .notes {
    width: 400px !important;
    .notes-content {
      & > div:first-child {
        width: 20px !important;
        padding-top: 0 !important;
      }
      & > div:last-child {
        width: calc(100% - 27px) !important;
        align-self: center;
        padding-left: 5px;
        text-align: left !important;
      }
    }
  }
}
.base-info-head {
  width: 100%;
  max-width: 1200px;
  margin-bottom: 10px;
}

.base-info-table {
  width: 100%;
  max-width: 1200px;
  background-color: #fff;
  border-collapse: collapse;
  border-right: 1px solid #ccc;
  border-bottom: 1px solid #ccc;
  line-height: 2;
  tr {
    td {
      padding: 3px 10px;
      border-top: 1px solid #ccc;
      border-left: 1px solid #ccc;
      em {
        color: $color-primary;
      }
      sub {
        vertical-align: bottom;
      }
      &[rowspan] + td {
        text-align: center;
      }
    }
    :first-child {
      text-align: center;
      line-height: normal;
    }
    :last-child {
      text-align: left;
    }
  }
}
</style>
